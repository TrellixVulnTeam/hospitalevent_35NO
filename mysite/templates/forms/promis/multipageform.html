{% extends "site_base.html" %}
{% load i18n %}
{% load static %}

{% block body_base %}
<main style="background-color:white !important;">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
<style>


#bodycontainer{
background-color:white !important;
}
* {
  box-sizing: border-box;
}

body {
  background-color: #f1f1f1;
}

#regForm {
  background-color: #ffffff;
  margin: 100px auto;
  font-family: Raleway;
  padding: 40px;
  width: 70%;
  min-width: 300px;
}

h1 {
  text-align: center;  
}



/* Mark input boxes that gets an error on validation: */
input.invalid {
  background-color: #ffdddd;
}

/* Hide all steps by default: */
.tab {
  display: none;
}

.form.button {
  background-color: #4CAF50;
  color: #ffffff;
  border: none;
  padding: 10px 20px;
  font-size: 17px;
  font-family: Raleway;
  cursor: pointer;
}

.form.button:hover {
  opacity: 0.8;
}

#prevBtn {
  background-color: #bbbbbb;
}

/* Make circles that indicate the steps of the form: */
.step {
  height: 15px;
  width: 15px;
  margin: 0 2px;
  background-color: #bbbbbb;
  border: none;  
  border-radius: 50%;
  display: inline-block;
  opacity: 0.5;
}

.step.active {
  opacity: 1;
}

/* Mark the steps that are finished and valid: */
.step.finish {
  background-color: #4CAF50;
}

.dragdealer{
    margin: 50px 8px 0;

    border-radius: 15px;
    background: #e9e9ea;

}
.dragdealer .green-circle{
    line-height: 30px;

    position: relative;
    z-index: 8;

    width: 30px;
    height: 30px;

    text-align: center;

    background: #fff;
}
.dragdealer .green-circle:after
{
    position: absolute;
    top: -8px;
    left: -8px;

    width: 46px;
    height: 46px;

    content: '';
    transition: all .1s;

    border: 8px solid #25bda8;
    border-radius: 50%;
    background: #fff;
    box-shadow: 0 8px 6px -6px rgba(0,0,0,.3);
}
.dragdealer.active .green-circle:after
{
    position: absolute;
    top: -10px;
    left: -10px;

    width: 50px;
    height: 50px;

    content: '';

    border: 14px solid #25bda8;
    border-radius: 50%;
    background: #a6e4db;
    box-shadow: 0 8px 6px -6px rgba(0,0,0,.3);
}


</style>
    <link href="{% static '/static/polymer_components/polymer/polymer.html' %}" rel="stylesheet">
<link href="{% static '/static/css/style.css' %}" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/dragdealer/0.9.9/dragdealer.css" rel="stylesheet">
<link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" rel="stylesheet">


<div style="background-color:white">
<form id="regForm"  action="" method="POST">
     {% csrf_token %}
  <h1>Fatigue:</h1>
  <!-- One "tab" for each step in the form: -->


  <div class="flexbox">
 <div class="flex-item">
      <div class="mood-box">
      <div class="face-wrapper">
          <div id="eyes" class="case3">
            <div class="eyebrow left"></div>
            <div class="eye left">
              <div class="eyelid"></div>
            </div>
            <div class="bottomlid left"></div>
            <div class="eyebrow right"></div>
            <div class="eye right">
              <div class="eyelid"></div>
            </div>
              <div class="bottomlid right"></div>
            
        </div>
        <div id="mouth" class="case3">
          <div id="mouth-open"></div>
        </div>
         <div id="face-bg" class="case3">
         <div class="face-light"></div>
        </div>
      </div>
      </div>
  </div></div>
    <br />

  <div class="tab" style="text-align:center;">
  <div class="grid-container">
  <div class="title">
  <h1>How often did you experience extreme exhaustion</h1> <br />
  </div>
<input type="hidden" name="formname" value="Fatigue">
<input type="hidden" name="q0" class="q0" value="3"></input>
</div>
</div>
  <div class="tab" style="text-align:center;">
  <div class="grid-container">
  <div class="title">
  <h1>How often did you feel tired even when you hadn't done anything</h1> <br />
  </div>

<input type="hidden" name="q1" class="q1" value="3"></input>
</div>
</div>
  <div class="tab" style="text-align:center;">
  <div class="grid-container">
  <div class="title">
  <h1>How often did you feel your fatigue was beyond your control?</h1> <br />
  </div>

<input type="hidden" name="q2" class="q2" value="3"></input>
</div>
</div>
  <div class="tab" style="text-align:center;">
  <div class="grid-container">
  <div class="title">
  <h1>How often were you sluggish?</h1> <br />
  </div>

<input type="hidden" name="q3" class="q3" value="3"></input>
</div>
</div>
  <div class="tab" style="text-align:center;">
  <div class="grid-container">
  <div class="title">
  <h1>How often did you run out of energy?</h1> <br />
  </div>

<input type="hidden" name="q4" class="q4" value="3"></input>
</div>
</div>
  <div class="tab" style="text-align:center;">
  <div class="grid-container">
  <div class="title">
  <h1>How often were you physically drained?</h1> <br />
  </div>

<input type="hidden" name="q5" class="q5" value="3"></input>
</div>
</div>
  <div class="tab" style="text-align:center;">
  <div class="grid-container">
  <div class="title">
  <h1>How often did you feel tired?</h1> <br />
  </div>

<input type="hidden" name="q6" class="q6" value="3"></input>
</div>
</div>
 <div class="tab" style="text-align:center;">
 <div style="max-width:50%; margin-left:25%;">
<canvas id="myChart" width="200" height="400"></canvas></div>

</div>
</div>

<div id="values" style="text-align:center; font-weight:bold; font-size: 20px;"></div>
   <div id="demo-simple-slider" class="dragdealer">
        <div class="handle green-circle">
			  	        <div class="icon">cir</div>
			        </div>
     </div><br /><br />
  <div style="overflow:auto;">
    <div style="float:right;">
      <button type="button" class="form button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
      <button type="button" class="form button" id="nextBtn" onclick="nextPrev(1)">Next</button>
    </div>
  </div>
  <!-- Circles which indicates the steps of the form: -->
  <div style="text-align:center;margin-top:40px;">
    <span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
	<span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
  </div>
</form>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dragdealer/0.9.8/dragdealer.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>

<script>
var currentTab = 0; // Current tab is set to be the first tab (0)
showTab(currentTab); // Display the crurrent tab

function showTab(n,s1) {
  // This function will display the specified tab of the form...
  var x = document.getElementsByClassName("tab");
  x[n].style.display = "block";
  //... and fix the Previous/Next buttons:
  if (n == 0) {
    document.getElementById("prevBtn").style.display = "none";

  } else {
    document.getElementById("prevBtn").style.display = "inline";
  }
  if (n == (x.length - 1)) {
    calcscore();
	$('.flexbox').hide();
	$("#values").hide()
	$('#demo-simple-slider').hide();
	document.getElementById("prevBtn").style.display = "none";
    document.getElementById("nextBtn").innerHTML = "Submit";
	document.getElementById("nextBtn").id = "Submit";
	
	
  } else {
    document.getElementById("nextBtn").innerHTML = "Next";

	
  }
  //... and run a function that will display the correct step indicator:
  
  fixStepIndicator(n)
}

function nextPrev(n) {
  // This function will figure out which tab to display
  var x = document.getElementsByClassName("tab");
  // Exit the function if any field in the current tab is invalid:
  if (n == 1 && !validateForm()) return false;
  // Hide the current tab:
  x[currentTab].style.display = "none";
  // Increase or decrease the current tab by 1:
  currentTab = currentTab + n;
  // if you have reached the end of the form...
  if (currentTab == x.length) {
    // ... the form gets submitted:

	document.getElementById("regForm").submit();
    return false;
  }
  // Otherwise, display the correct tab:
  
  showTab(currentTab);
}

function validateForm() {
  // This function deals with validation of the form fields
  var x, y, i, valid = true;
  x = document.getElementsByClassName("tab");
  y = x[currentTab].getElementsByTagName("input");
  // A loop that checks every input field in the current tab:
  for (i = 0; i < y.length; i++) {
    // If a field is empty...
    if (y[i].value == "") {
      // add an "invalid" class to the field:
      y[i].className += " invalid";
      // and set the current valid status to false
      valid = false;
    }
  }
  // If the valid status is true, mark the step as finished and valid:
  if (valid) {
    document.getElementsByClassName("step")[currentTab].className += " finish";
  }
  return valid; // return the valid status
}

function fixStepIndicator(n) {
  // This function removes the "active" class of all steps...
  var i, x = document.getElementsByClassName("step");
  for (i = 0; i < x.length; i++) {
    x[i].className = x[i].className.replace(" active", "");
  }
  //... and adds the "active" class on the current step:
  x[n].className += " active";


}
var icon = $('.icon')
	var widget = $('.slide')
	var steps = 5
	
	var dd = new Dragdealer('demo-simple-slider',{
		
		horizontal: true,
		steps: steps,
		speed: 0.3,
		loose: false,
		animationCallback: function(x, y) {
			
			
			var percent = parseInt(steps * (x*100), 10);
			var face =  $(".face-wrapper").children();
			var curstep = this.getStep();

	  $(".q"+currentTab+"").val(curstep[0]);
      switch(curstep[0]){
          
        case 1:
          removeClass();
          $(face).addClass("case5");
		  $("#values").text("Never");
		  
        break;
          
        case 2:
          removeClass();
          $(face).addClass("case4");  
		  $("#values").text("Rarely");
        break;
          
        case 3:
          removeClass();
          $(face).addClass("case3");
		  $("#values").text("Sometimes");
        break;
          
        case 4:
          removeClass();
          $(face).addClass("case2");
		  $("#values").text("Often");
        break;
          
        case 5:
          removeClass();
          $(face).addClass("case1");
		  $("#values").text("Always");
        break; 
		
      $('.title').text(Math.round(percent/100));
	  
		}
		} 
	}); 
	dd.setStep(3);
	$("#nextBtn").on("click",function(){
		dd.setStep($(".q"+currentTab+"").attr('value'));
		});
		
	$("#prevBtn").on("click",function(){
		dd.setStep($(".q"+currentTab+"").attr('value'));
		});
	function removeClass(){
  $(".face-wrapper").children().removeAttr('class');
}

function calcscore(){
var average = 15.5
var total = 0
var question = currentTab-1;
while(question >= 0){
total = total + parseInt($(".q"+question+"").attr('value'));
question = question - 1;
}
var zscore = (total - average)/10;

var ctx = document.getElementById("myChart");
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["Your Score: " + total, "Average: " +  average],
        datasets: [{
            
            data: [total, average],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',

            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',

            ],
            borderWidth: 1
        }]
    },
    options: {
	  responsive: true,
		maintainAspectRatio: false,
		legend: {
            display: false
			},
        scales: {
		xAxes:[{
		  gridLines: {
                    display:false
                }
		}],
            yAxes: [{
                ticks: {
                    beginAtZero:true,
					max: 30
                },
				  gridLines: {
                    display:false
                }
            }]
        }
    }
});

}


</script>
</div>
</main>
{% endblock %}
